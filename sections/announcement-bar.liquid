<style>
  :root {
    --enable-sticky-announcement-bar: {% if section.settings.announcement_bar_position == 'non_sticky' or section.settings.announcement_bar_position == 'sticky_desktop' %}0{% else %}1{% endif %};
  }

  #shopify-section-{{ section.id }} {
    {%- if section.settings.announcement_bar_position == 'sticky' or section.settings.announcement_bar_position == 'sticky_mobile' -%}
      position: -webkit-sticky;
      position: sticky;
      top: 0;
      z-index: 5; /* Make sure it goes over header */
    {%- else -%}
      position: relative;
    {%- endif -%}
  }

  @media screen and (min-width: 741px) {
    :root {
      --enable-sticky-announcement-bar: {% if section.settings.announcement_bar_position == 'non_sticky' or section.settings.announcement_bar_position == 'sticky_mobile' %}0{% else %}1{% endif %};
    }

    #shopify-section-{{ section.id }} {
      {%- if section.settings.announcement_bar_position == 'sticky' or section.settings.announcement_bar_position == 'sticky_desktop' -%}
        position: -webkit-sticky;
        position: sticky;
        top: 0;
        z-index: 5; /* Make sure it goes over header */
      {%- else -%}
        position: relative;
        z-index: unset;
      {%- endif -%}
    }
  }
</style>

{%- if section.blocks.size > 0 -%}
  <section>
    <announcement-bar
      {% if section.blocks.size > 1 and section.settings.autoplay %}
        auto-play cycle-speed="{{ section.settings.cycle_speed | escape }}"
      {% endif %}
      class="announcement-bar py-2 {% if section.blocks.size > 1 %}announcement-bar--multiple{% endif %}">
      {% comment %}
        {%- if section.blocks.size > 1 -%}
          <button
            data-action="prev"
            class="tap-area tap-area--large">
            <span class="visually-hidden">
              {{- 'general.accessibility.previous' | t -}}
            </span>
            {% render 'icon' with 'nav-arrow-left-small', direction_aware: true %}
          </button>
        {%- endif -%}
      {% endcomment %}

      <div class="announcement-bar__list flex justify-center text-[14px] space-x-8 font-semibold">
        {%- for block in section.blocks -%}
          <announcement-bar-item
            class="announcement-bar__item">
            <p>
              {{ block.settings.text | escape }}
            </p>
          </announcement-bar-item>
        {%- endfor -%}
      </div>

      {% comment %}
        {%- if section.blocks.size > 1 -%}
          <button
            data-action="next"
            class="tap-area tap-area--large">
            <span class="visually-hidden">
              {{- 'general.accessibility.next' | t -}}
            </span>
            {% render 'icon' with 'nav-arrow-right-small',
              direction_aware: true
            %}
          </button>
        {%- endif -%}
      {% endcomment %}
    </announcement-bar>
  </section>

  <script>
    document.documentElement.style.setProperty(
      '--announcement-bar-height',
      document.getElementById('shopify-section-{{ section.id }}').clientHeight +
        'px'
    );
  </script>
{%- endif -%}

{% schema %}
{
  "name": "Announcement bar",
  "class": "shopify-section--announcement-bar",
  "max_blocks": 4,
  "blocks": [
    {
      "type": "message",
      "name": "Message",
      "settings": [
        {
          "type": "text",
          "id": "text",
          "label": "Text",
          "default": "Announce something here"
        },
        {
          "type": "image_picker",
          "id": "image",
          "label": "Image"
        }
      ]
    }
  ],
  "settings": [
    {
      "type": "select",
      "id": "announcement_bar_position",
      "label": "Position",
      "options": [
        {
          "value": "non_sticky",
          "label": "Non sticky"
        },
        {
          "value": "sticky_desktop",
          "label": "Sticky on desktop only"
        },
        {
          "value": "sticky_mobile",
          "label": "Sticky on mobile only"
        },
        {
          "value": "sticky",
          "label": "Sticky everywhere"
        }
      ],
      "default": "non_sticky"
    },
    {
      "type": "select",
      "id": "announcement_text_size",
      "label": "Text size",
      "options": [
        {
          "value": "small",
          "label": "Small"
        },
        {
          "value": "normal",
          "label": "Normal"
        },
        {
          "value": "large",
          "label": "Large"
        }
      ],
      "default": "normal"
    },
    {
      "type": "checkbox",
      "id": "autoplay",
      "label": "Auto rotate between messages",
      "default": true
    },
    {
      "type": "range",
      "id": "cycle_speed",
      "min": 3,
      "max": 20,
      "step": 1,
      "unit": "sec",
      "label": "Change message every",
      "default": 5
    }
  ],
  "default": {
    "blocks": [
      {
        "type": "message"
      }
    ]
  }
}
{% endschema %}
